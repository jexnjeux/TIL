# ì—°ê´€ê´€ê³„ ë§¤í•‘

ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒ

## ë§¤í•‘ ë°©ë²•

- ORM
  - ì°¸ì¡°ë¥¼ ì‚¬ìš©
  - ë°©í–¥ì„±ì´ ìˆìŒ
- RDB
  - ì™¸ë˜í‚¤ë¥¼ ì‚¬ìš©
  - í•­ìƒ ì–‘ë°©í–¥

### ë‹¤ëŒ€ì¼(N:1) ì—°ê´€ê´€ê³„

- user ê°ì²´ì™€ team ê°ì²´ê°€ ìˆë”°.
- userëŠ” í•˜ë‚˜ì˜ teamì—ë§Œ ì†Œì†ë  ìˆ˜ ìˆë‹¤.
- userì™€ teamì€ ë‹¤ëŒ€ì¼ ê´€ê³„ë‹¤.

### ê°ì²´ ì—°ê´€ê´€ê³„

![ê°ì²´ì—°ê´€ê´€ê³„](./image/ê°ì²´ì—°ê´€ê´€ê³„.png)

- User ê°ì²´ëŠ” User.teamí•„ë“œë¡œ Team ê°ì²´ì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- User ê°ì²´ì™€ Team ê°ì²´ëŠ” ë‹¨ë°©í–¥ì´ë‹¤.
  - Userì— team í•„ë“œê°€ ìˆì§€ë§Œ Teamì— user í•„ë“œëŠ” ì—†ìŒ

### í…Œì´ë¸” ì—°ê´€ê´€ê³„

![í…Œì´ë¸”ì—°ê´€ê´€ê³„](./image/í…Œì´ë¸”ì—°ê´€ê´€ê³„.png)

- User í…Œì´ë¸”ì€ team_id ì™¸ë˜í‚¤ë¥¼ í†µí•´ì„œ Team í…Œì´ë¸”ê³¼ ì—°ê³ ë‚˜ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- Userì™€ Teamì€ ì–‘ë°©í–¥ ê´€ê³„ë‹¤.

### ê°ì²´ ì—°ê´€ê´€ê³„ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„

|                    | ê°ì²´ ì—°ê´€ê´€ê³„ | í…Œì´ë¸” ì—°ê´€ê´€ê³„ |
| ------------------ | ------------- | --------------- |
| ì—°ê´€ê´€ê³„ ë§ºëŠ” ë°©ë²• | ì°¸ì¡°          | ì™¸ë˜í‚¤          |
| ë°©í–¥               | í•­ìƒ ë‹¨ë°©í–¥   | í•­ìƒ ì–‘ë°©í–¥     |

> ğŸ’¡ ê°ì²´ ì—°ê´€ê´€ê³„ì—ì„œ ì–‘ë°©í–¥ì´ë¼ê³  ë§í•˜ëŠ” ê²ƒì€ ì‚¬ì‹¤ ë‘ê°œì˜ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì´ë‹¤.

## @ManyToOne, @OneToMany, @OneToOne, @ManyToMany

ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜

### ì†ì„±

- optional: falseë¡œ ì„¤ì • ì‹œ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤.
  - defaultëŠ” true
- fetch: ê¸€ë¡œë²Œ í˜ì¹˜ ì „ëµì„ ì„¤ì •í•œë‹¤.
  - FetchType.EAGER: ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ê°€ì ¸ì˜´
  - FetchType.LAZY: ì—°ê´€ëœ ì—”í‹°í‹°ê°€ ì‚¬ìš©ë˜ëŠ” ìˆœê°„ì— ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜´

```java
@Entity
public class User {
  @MayToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "user_group_id")
  private UserGroup userGroup;
}
```

- user ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì™”ì„ ë–„, ì—°ê´€ëœ userGroupì´ ìˆë”ë¼ë„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ì•Šê³ , 'ì—°ê´€ëœ userGroupì´ ì¡´ì¬í•œë‹¤' ë¼ëŠ” ì •ë³´ë§Œ ê°€ì§€ê³  ìˆëŠ”ë‹¤.

## @JoinColumn

ì™¸ë˜í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜

### íŠ¹ì§•

- name ì†ì„±ì„ ì´ìš©í•´ ë§¤í•‘ì„ ì™¸ë˜í‚¤ ì´ë¦„ì„ ì§€ì •í•œë‹¤.
  - default: [í•„ë“œëª…+_+ì°¸ì¡° í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ ì»¬ëŸ¼ëª…]

```java
@Entity
public class UserDetail {

  @OneToOne
  @JoinColumn(name="user_id")
  private User user;
}
```

- userì˜ idë¥¼ ì™¸ë˜í‚¤ë¡œ ê°€ì§€ê³  ìˆë‹¤.
- nameì„ ì§€ìš´ë‹¤ë©´ `user_{user ì—”í‹°í‹°ì˜ ê¸°ë³¸í‚¤}`ë¥¼ ì™¸ë˜í‚¤ ì´ë¦„ìœ¼ë¡œ ê°–ëŠ”ë‹¤.

## CRUD

### ì €ì¥ (Create & Update)

- ì—”í‹°í‹°ì˜ ì—°ê´€ê´€ê³„ë¥¼ ì´ìš©í•˜ì—¬ ì €ì¥

### ì¡°íšŒ (Read)

- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš©

### ì œê±° (Delete)

```java

```

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

User -> Team ë¿ ë§Œ ì•„ë‹ˆë¼ Team -> User ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

### ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ (mapped by)

#### ê°œë…

- ì—”í‹°í‹°ëŠ” ì°¸ì¡°ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•œë‹¤.
  - í…Œì´ë¸” ì™¸ë˜í‚¤ í•˜ë‚˜ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬
- ì—°ê´€ê´€ê³„ê°€ ë‹¨ë°©í–¥ì¼ ê²½ìš°, ì°¸ì¡°ë¥¼ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ë©´ ëœë‹¤.
- ì—°ê´€ê´€ê³„ê°€ ì–‘ë°©í–¥ì¼ ê²½ìš°, ì°¸ì¡°ê°€ ë‘ ê³³ì´ê¸° ë•Œë¬¸ì— ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ëŠ” í¬ì¸íŠ¸ê°€ 2ê³³ì´ ëœë‹¤.
- ë‘ ê°ì²´ ì¤‘ í•˜ë‚˜ë¥¼ ì •í•´ì„œ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ”ë°, ì´ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ë¼ê³  í•œë‹¤.

#### íŠ¹ì§•

- ì£¼ì¸ë§Œ ë“±ë¡, ìˆ˜ì •, ì‚­ì œë¥¼ í•  ìˆ˜ ìˆë‹¤.
  - ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ `mappedBy` ì†ì„±ì´ ì—†ëŠ” ìª½ì´ë‹¤.
  - ì£¼ì¸ì´ ì•„ë‹Œê²½ìš° `mappedBy` ì„¤ì •
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•˜ëŠ” ê²ƒì€ ì™¸ë˜í‚¤ ê´€ë¦¬ìë¥¼ ì •í•˜ëŠ” ê²ƒì´ë‹¤.

```java
@Entity
public class User {
  @ManyToOne(fetch = FetchType = LAZY)
  @JoinColumn(name = "user_group_id")
  private UserGroup userGroup;

  @OneToOne(mappedBy = "user")
  private UserDetail userDetail;
}

@Entity
public class UserGroup {
  @OneToMany(mappedBy = "userGroup")
  private List<User> userList;
}
```

- user ì—”í‹°í‹°ì™€ userGroup ì—”í‹°í‹° ì‚¬ì´ì—ì„œ ì—°ê´€ê´€ê³„ ì£¼ì¸ì€ user ì—”í‹°í‹°
- user ì—”í‹°í‹°ì™€ userDetail ì—”í‹°í‹° ì‚¬ì´ì—ì„œ ì—°ê´€ê´€ê³„ ì£¼ì¸ì€ userDetail ì—”í‹°í‹°

## ì—°ê´€ê´€ê³„ ë§¤í•‘ ì‹œ ì£¼ì˜ì‚¬í•­

### ë‹¤ëŒ€ì¼(@ManyToOne, N:1)

- ë‹¤ëŒ€ì¼ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì€ í•­ìƒ ì¼ëŒ€ë‹¤ ê´€ê³„ì´ë‹¤.
- DB í…Œì´ë¸”ì˜ 1:N ê´€ê³„ì—ì„œ ì™¸ë˜í‚¤ëŠ” í•­ìƒ Nìª½ì— ìˆê¸° ë•Œë¬¸ì— ê°ì²´ ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í•­ìƒ Nìª½ì´ë‹¤.

```java
@Entity
public class User {
  @ManyToOne(fetch = FetchType = LAZY)
  @JoinColumn(name = "user_group_id")
  private UserGroup userGroup;
}

@Entity
public class UserGroup {
  @OneToMany(mappedBy = "userGroup")
  private List<User> userList;
}
```

- group í•˜ë‚˜ì— ì—¬ëŸ¬ëª…ì˜ ìœ ì €ê°€ ì†í•  ìˆ˜ ìˆë‹¤.
- userì…ì¥ì—ì„œ ë‹¤ëŒ€ì¼ ê´€ê³„ì´ê³ , group ì…ì¥ì—ì„œ ì¼ëŒ€ë‹¤ ê´€ê³„ì´ë‹¤.
- ì™¸ë˜í‚¤ ê´€ë¦¬ëŠ” user ìª½ì—ì„œ í•˜ê³ , mappedByëŠ” groupìª½ì— ì„¤ì •í•œë‹¤.

### ì¼ëŒ€ë‹¤(@OneToMany, 1:N)

- ì¼ëŒ€ë‹¤ ê´€ê³„ì˜ ë°˜ëŒ€ ë°©í–¥ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ì´ë‹¤.
- ì¼ëŒ€ë‹¤ ê´€ê³„ëŠ” ì—”í‹°í‹°ë¥¼ í•˜ë‚˜ ì´ìƒ ì°¸ì¡°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•œë‹¤.

#### ì¼ë‹¤ë‹¤ ë‹¨ë°©í–¥ ë§¤í•‘ ë‹¨ì 

- ë§¤í•‘í•œ ê°ì²´ê°€ ê´€ë¦¬í•˜ëŠ” ì™¸ë˜í‚¤ê°€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìˆê¸° ë•Œë¬¸ì— ì—°ê´€ê´€ê³„ ì²˜ë¦¬ë¥¼ ìœ„í•œ UPDATE SQLì„ ì¶”ê°€ë¡œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.

```java
@Enttity
public class User {

}

@Entity
public class UserGroup {
  @ONeToMany
  @JoinColumn(name="user_group_id")
  private List<User> userList;
}
```

- ë‹¨ë°©í–¥ ê´€ê³„ë‹ˆê¹Œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ userGroupì´ ëœë‹¤.
- JoinColumnì„ í•­ìƒ ëª…ì‹œí•´ì•¼ í•œë‹¤.(user ì—”í‹°í‹°ì˜ userGroupIdì»¬ëŸ¼ì— ê´€ê³„ë¥¼ ì„¤ì •)
- ì˜ˆë¥¼ ë“¤ì–´ UserGroup1ì— User1 ~ User100ì„ ë„£ëŠ”ë‹¤ë©´ update ì¿¼ë¦¬ê°€ 100ë²ˆ ë°œìƒí•œë‹¤.
- ë”°ë¼ì„œ ì–‘ë°©í–¥ ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ìœ ë¦¬í•˜ë‹¤.

## ì¼ëŒ€ì¼(@OneToOne)

- ì¼ëŒ€ì¼ ê´€ê³„ëŠ” ë°˜ëŒ€ë„ ì¼ëŒ€ì¼ì´ë‹¤.
- ì–´ë–¤ í…Œì´ë¸”ì´ë“  ì™¸ë˜í‚¤ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
  - í…Œì´ë¸”ì—ì„œ ì¼ëŒ€ë‹¤/ë‹¤ì• ì¼ ê´€ê³„ëŠ” í•­ìƒ ë‹¤(N)ìª½ì´ ì™¸ë˜í‚¤ë¥¼ ê°€ì§

### ì™¸ë˜í‚¤ ê´€ë¦¬

- ì£¼ í…Œì´ë¸”ì—ì„œ ê´€ë¦¬
  - ì£¼ ê°ì²´ê°€ ëŒ€ìƒ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì£¼ í…Œì´ë¸”ì— ì™¸ë˜í‚¤ë¥¼ ë‘ê³  ëŒ€ìƒ í…Œì´ë¸”ì„ ì°¸ì¡°
  - ì™¸ë˜í‚¤ë¥¼ ê°ì²´ ì°¸ì¡°ì™€ ë¹„ìŠ·í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
  - ì£¼ í…Œì´ë¸”ë§Œ í™•ì¸í•´ë„ ëŒ€ìƒ í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆìŒ
- ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜í‚¤
  - í…Œì´ë¸” ê´€ê³„ë¥¼ ì¼ëŒ€ì¼ì—ì„œ ì¼ëŒ€ë‹¤ë¡œ ë³€ê²½í• ë–„ êµ¬ì¡° ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥

```java
@Entity
public class UserDetail {
  @OneToOne
  @JoinColumn(name = "user_id")
  private User user;
}
```

- ì£¼ í…Œì´ë¸”ì—ì„œ ê´€ë¦¬í•œë‹¤ë©´ ì™¸ë˜í‚¤ (`user_id`)ë¥¼ ê°ì²´ì°¸ì¡°ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```java
@Entity
public class User {
  @OneToOne
  @JoinColumn(name = "user_id")
  private UserDetail userDetail;
}

@Entity
public class UserDetail {
  @OneToOne(mappedBy = "user")
  private User user;
}
```

- ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜í‚¤ê°€ ìˆë‹¤ë©´ êµ¬ì¡°ë¥¼ ë°”ê¾¸ë”ë¼ê³ (ì¼ëŒ€ì¼ -> ì¼ëŒ€ë‹¤) ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

## ë‹¤ëŒ€ë‹¤(@ManyToMany, N:M)

- RDBì—ì„œëŠ” ì •ê·œí™”ëœ í…Œì´ë¸” 2ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.
- ì—°ê²° í…Œì´ë¸”ì„ ì‚¬ìš©í•œë‹¤.
  - @JoinTable: ë‹¤ëŒ€ë‹¤ ë§¤í•‘ì„ ìœ„í•´ ì—°ê²° í…Œì´ë¸” ì„¤ì •
- í•˜ì§€ë§Œ ì—°ê²° í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ì‹ë³„ìë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢€ ë” ì•ˆì •ì ì´ë‹¤.

## ê³ ê¸‰ ë§¤í•‘

- ìƒì† ê´€ê³„ ë§¤í•‘: ê°ì²´ì˜ ìƒì†ê´€ê³„ë¥¼ DBì— ë§¤í•‘í•˜ëŠ” ë°©ë²•
- ë³µí•©í‚¤ì™€ ì‹ë³„ ê´€ê³„ ë§¤í•‘: DBì˜ ì‹ë³„ìê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ë§¤í•‘í•˜ëŠ” ë°©ë²•
- @MappedSuperclass: ë“±ë¡ì¼, ìˆ˜ì •ì¼ ê°™ì€ ì—¬ëŸ¬ ì—”í‹°í‹°ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë§¤í•‘ ì •ë³´ë§Œ ìƒì†
- ì¡°ì¸ í…Œì´ë¸”: í…Œì´ë¸” ì—°ê´€ê´€ê³„ë¥¼ ìœ„í•´ì„œ ì—°ê²° í…Œì´ë¸”ì„ ë§¤í•‘í•˜ëŠ” ë°©ë²•
- ì—”í‹°í‹° í•˜ë‚˜ì— ì—¬ëŸ¬ í…Œì´ë¸” ë§¤í•‘
  - @SecondaryTable

> ğŸ’¡ ì‹ë³„ ê´€ê³„ê°€ ì •ë§ í•„ìš”í•œì§€ ê³ ë¯¼í•´ë³´ì! ê°€ê¸‰ì  ë¹„ì‹ë³„ ê´€ê³„ë¥¼ ì‚¬ìš©í•œë‹¤.

### @MappedSuperclass

- ë¶€ëª¨ í´ë˜ìŠ¤ëŠ” í…Œì´ë¸”ê³¼ ë§¤í•‘í•˜ì§€ ì•Šê³ , ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ëŠ” ìì‹ í´ë˜ìŠ¤ì—ê²Œ ë§¤í•‘ ì •ë³´ë§Œ ì œê³µí•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤.
- @EntityëŠ” ì‹¤ì œ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ì§€ë§Œ, @MappedSuperclassëŠ” í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ë‹¨ìˆœíˆ ë§¤í•‘ ì •ë³´ë¥¼ ìƒì†í•  ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
- ì—°ê´€ê´€ê³„ë¥¼ ì¬ì •ì˜í• ë•ŒëŠ” @AssociationOverrideë¥¼ ì‚¬ìš©í•œë‹¤.

```java
@MappedSuperclass
@Data
public abstract class BaseEntity {
  private Date createdAt;
  private Date updatedAt;
}

@Entity
public class User extends BaseEntity {
  ...
  public User(String name, UserTypeEnum userType, Date now) {
    this.name = name;
    this.userType = userType;
    super.setCreatedAt(now);
    super.setUPdatedAt(now);
  }
}
```
