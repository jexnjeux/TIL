# ORM (Object Relational Mapping) 객체 - 관계 매핑

## 개념

- 객체와 관계형 데이터베이스의 데이터를 자동으로 매핑(연결)해 주는 것
- 애플리케이션과 데이터베이스 연결 시 SQL이 아닌, 애플리케이션 개발 언어로 데이터베이스에 접근 가능

> **Database(SQL)를 직접 다룰 때 발생하는 문제점**
>
> - 코드에 반복이 발생 <br/>
> - SQL에 의존적인 개발
>   - 테이블 구조 변경, 쿼리 조건 변경 시 연관되는 쿼리 수정 필요
>   - 특정 데이터베이스에 종속적

## 장점

- 객체지향적 접근
  - 개발자가 비즈니스 로직에 집중 가능
  - 코드 재사용으로 유지보수 편리성 증대, 생산성 증가
- 매핑 정보 명확
  - ERD를 보는 것에 대한 의존성을 낮춤
- DBMS에 대한 종속성 줄어듦

## 단점

- 프로젝트의 복잡성이 올라가면 구현 난이도도 올라감
- 잘못 구현한 경우 속도 저하의 문제가 발생할 수 있음

# JPA (Java Persistence API)

## 개념

Java의 ORM 표준 기술로 Application과 JDBC 사이에서 동작한다.

## 구현체

- Hibernate
- Spring Data JPA
  - JPA를 한단계 추상화시킨 Repository 인터페이스를 제공

## 어노테이션

### `@Entity`

테이블과 매핑한다고 JPA에게 알려주는 어노테이션

### `@Table`

- 엔티티 클래스에 매핑할 테이블 정보를 알려줌
- name 속성을 이용하여 테이블 이름을 지정하고, 생략된다면 클래스 이름을 테이블 이름으로 매핑

### `@Id`

- 엔티티 클래스의 필드를 테이블의 기본키에 매핑

### `@Column`

- 엔티티 클래스의 필드를 테이블의 컬럼과 매핑

```java
@Entity
@Table(name = "Member")
public class Member {

  @Id
  @Column(name="id")
  @GeneratedValue(stratege = GenerationType.IDENTITY) // 값 생성을 데이터베이스에 위임
  private Long id;

  @Column(name = "member_id")
  private String memberId;

  @Column
  private String name;
}
```

## 엔티티 매니저

- 특정 작업을 위해서 데이터베이스에 액세스하는 역할을 담당
- 엔티티를 DB에 등록, 수정, 삭제, 조회하는 역할

### 주의사항

- 엔티티 매니저 팩토리는 어플리케이션 전체에서 딱 한번만 생성하고 공유해서 사용
  - 엔티티 매니저 팩토리는 설정 정보를 읽어와 DB 커넥션 풀을 생성하기 때문에 엔티티 매니저 팩토리 생성비용은 매우 큼
- 엔티티 매니저는 스레드 간에 공유하거나 재사용 안됨
  - 엔티티 매니저는 데이터베이스 커넥션과 밀접한 관계가 있으므로
- 사용이 끝난 엔티티 매니저는 반드시 종료함

| 엔티티 매니저 팩토리                                                                  | 엔티티 매니저                                                               |
| ------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- |
| 생성 비용이 크기때문에 DB를 하나만 사용하는 어플리케이션이라면 일반적으로 하나만 만듦 | 엔티티 매니저 팩토리를 이용해서 생성                                        |
| 스레드 세이프하기 때문에 여러 스레드가 동시 접근해도 안전                             | 여러 스레드가 동시에 접근하면 동시성 문제가 발생하기 떄문에 공유해서는 안됨 |

> 💡 스프링 부트에서는 엔티티 매니저 팩토리를 제공한다. 꼭 필요한 경우을 제외하고는 직접 엔티티 매니저 팩토리를 설정하지 않아도 된다.
